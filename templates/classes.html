{% extends "home.html" %}

{% block content %}
<div class="container my-5">
    <h1 class="text-center mb-4">Curriculum Progress Tracker</h1>

    <!-- Learned Progress Bar -->
    <h5>Learned Progress</h5>
    <div class="progress mb-3">
        <div
            id="learnedProgressBar"
            class="progress-bar progress-bar-striped bg-success"
            role="progressbar"
            style="width: {{ learned_progress }}%;"
            aria-valuenow="{{ learned_progress }}"
            aria-valuemin="0"
            aria-valuemax="100"
        >
            {{ learned_progress | round(1) }}%
        </div>
    </div>

    <!-- Proficient Progress Bar -->
    <h5>Proficient Progress</h5>
    <div class="progress mb-5">
        <div
            id="proficientProgressBar"
            class="progress-bar progress-bar-striped bg-info"
            role="progressbar"
            style="width: {{ proficient_progress }}%;"
            aria-valuenow="{{ proficient_progress }}"
            aria-valuemin="0"
            aria-valuemax="100"
        >
            {{ proficient_progress | round(1) }}%
        </div>
    </div>

    <form method="post">
        {% for item in items %}
        <div class="list-element row align-items-center mb-3">
            <div class="col-md-4">
                <h5>{{ item.title }}</h5>
            </div>
            <div class="col-md-4">
                <a href="{{ item.video_url }}" target="_blank" class="btn btn-primary">Watch Video</a>
            </div>
            <div class="col-md-4">
                <div class="form-check">
                    <input
                        class="form-check-input"
                        type="checkbox"
                        id="learned_{{ item.id }}"
                        name="learned_{{ item.id }}"
                        {% if progress[item.id]['learned'] %}checked{% endif %}
                    >
                    <label class="form-check-label" for="learned_{{ item.id }}">
                        Learned 
                    </label>
                </div>
                <div class="form-check">
                    <input
                        class="form-check-input"
                        type="checkbox"
                        id="proficient_{{ item.id }}"
                        name="proficient_{{ item.id }}"
                        {% if progress[item.id]['proficient'] %}checked{% endif %}
                    >
                    <label class="form-check-label" for="proficient_{{ item.id }}">
                       Proficient 
                    </label>
                </div>
            </div>
        </div>
        {% endfor %}
        <div class="text-center">
            <button type="submit" class="btn btn-primary">Update Progress</button>
        </div>
    </form>
</div>

<!-- Optional JavaScript to update progress bars in real-time -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const learnedCheckboxes = document.querySelectorAll('input[id^="learned_"]');
        const proficientCheckboxes = document.querySelectorAll('input[id^="proficient_"]');
        const learnedProgressBar = document.getElementById('learnedProgressBar');
        const proficientProgressBar = document.getElementById('proficientProgressBar');
        const totalItems = {{ total_items }};

        function updateProgress() {
            let learnedCount = 0;
            let proficientCount = 0;

            learnedCheckboxes.forEach(cb => {
                if (cb.checked) learnedCount++;
            });

            proficientCheckboxes.forEach(cb => {
                if (cb.checked) proficientCount++;
            });

            const learnedProgress = totalItems > 0 ? (learnedCount / totalItems) * 100 : 0;
            const proficientProgress = totalItems > 0 ? (proficientCount / totalItems) * 100 : 0;

            learnedProgressBar.style.width = learnedProgress + '%';
            learnedProgressBar.setAttribute('aria-valuenow', learnedProgress);
            learnedProgressBar.textContent = learnedProgress.toFixed(1) + '%';

            proficientProgressBar.style.width = proficientProgress + '%';
            proficientProgressBar.setAttribute('aria-valuenow', proficientProgress);
            proficientProgressBar.textContent = proficientProgress.toFixed(1) + '%';
        }

        // Add event listeners to checkboxes
        learnedCheckboxes.forEach(cb => {
            cb.addEventListener('change', updateProgress);
        });

        proficientCheckboxes.forEach(cb => {
            cb.addEventListener('change', updateProgress);
        });
    });
</script>
{% endblock %}